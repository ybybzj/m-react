!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("m-react",e):t.mReact=e()}(this,function(){"use strict";function t(){}function e(t){if(null===t)return"null";if(void 0===t)return"undefined";if(t!==t)return"NaN";var e=Object.prototype.toString.call(t).match(vt);return null==e?"unknown":e[1].toLowerCase()}function n(){return gt.apply(arguments[0],gt.call(arguments,1))}function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function o(){for(var t,e,n,o=arguments.length,i=0;i<o&&(n=arguments[i],n!==Object(n));)i++;if(i===o)return{};for(i++;i<o;)if(e=arguments[i++],e===Object(e))for(t in e)r(e,t)&&(n[t]=e[t]);return n}function i(){var t=n(arguments);return o.apply(null,[{}].concat(t))}function a(t){if("object"!==e(t))throw new TypeError("[removeVoidValue]param should be a object! given: "+t);var n={};return Object.keys(t).forEach(function(e){void 0!==t[e]&&(n[e]=t[e])}),n}function s(t){for(var n=[],r=!0,o=0,i=t.length;o<i;o++){var a=t[o];if("array"!==e(a)){r=!1;break}n.push(a)}return n=r===!1||0===t.length?t:[].concat.apply([],n)}function l(t){switch(e(t)){case"undefined":case"null":return[];case"array":return s(t);default:return[t]}}function u(){return Object.create(null)}function c(t,n){return"string"!==e(t)||"regexp"!==e(n)?null:t.match(n)}function h(t,e){if(t===e)return e;var n=t.compareDocumentPosition(e);return 24&n?16&n?t:e:null}function f(e,r){var o=function(){return(e.controller||t).apply(this,r)||this};e.controller&&(o.prototype=e.controller.prototype);var i=function(t){return arguments.length>1&&(r=r.concat(n(arguments,1))),e.view.apply(e,r.length?[t].concat(r):[t])};i.$original=e.view;var a={controller:o,view:i};return r[0]&&null!=r[0].key&&(a.attrs={key:r[0].key}),a}function d(t){return f(t,n(arguments,1))}function p(t){return"object"===e(t)&&"function"===e(t.controller)&&"function"===e(t.view)}function v(t){return"object"===e(t)&&"string"===e(t.tag)&&"object"===e(t.attrs)}function g(){var t=arguments[0],r=arguments[1],o=n(arguments,2);if(p(t))return d(t,r,o);if("function"===e(t))return t(r);if(v(t)||Array.isArray(t)&&t.every(function(t){return v(t)||null==t}))return t;if("string"!==e(t))throw new Error("selector in m(selector, attrs, children) should be a string");var i,a,s,l=!(null==r||"object"!==e(r)||"tag"in r||"view"in r||"subtree"in r),u={tag:"div",attrs:{}},c=[];r=l?r:{},s="class"in r?"class":"className",o=l?o:n(arguments,1),u.children="array"===e(o[0])?o[0]:o;for(;i=mt.exec(t);)""===i[1]&&i[2]?u.tag=i[2]:"#"===i[1]?u.attrs.id=i[2]:"."===i[1]?c.push(i[2]):"["===i[3][0]&&(a=yt.exec(i[3]),u.attrs[a[1]]=a[3]||!a[2]||"");return Object.keys(r).forEach(function(t){var n=r[t];t===s&&"string"===e(n)&&""!==n.trim()?(c.push(n),u.attrs[t]=""):u.attrs[t]=n}),c.length>0&&(u.attrs[s]=c.join(" ")),u}function m(n){this.options=n||{};var r=this.options.onFlush;this._cb="function"===e(r)?r:t,this._queue=[],this.flush=this.flush.bind(this)}function y(){return!this instanceof y?new y:(this._index=-1,this._keys=[],void(this._values=[]))}function w(t,e){return isNaN(t)?isNaN(e):t===e}function b(t){if(t!==Object(t))throw new TypeError("[Map]Invalid value used as a map key! given: "+t)}function k(t){if(!this instanceof k)return new k(t);if(t=t||kt||{documentElement:1},!t.documentElement)throw new Error('[DOMDelegator]Invalid parameter "doc", should be a document object! given: '+t);this.root=t.documentElement,this.listenedEvents=u(),this.eventDispatchers=u(),this.globalListeners=u(),this.domEvHandlerMap=new y}function E(t,e){var n=e.globalListeners,r=e.root;return function(o){var i=n[t]||[];if(i&&i.length>0){var a=new M(o);a.target=r,j(i,a)}_(o.target,o,t,e)}}function _(t,e,n,r){var o=x(t,n,r);if(o&&o.handlers.length>0){var i=new M(e);i.currentTarget=o.currentTarget,j(o.handlers,i),i._bubbles&&_(o.currentTarget.parentNode,e,n,r)}}function x(t,e,n){if(null==t)return null;var r,o=O(n.domEvHandlerMap,t);return o&&(r=o[e])&&0!==r.length?{currentTarget:t,handlers:r}:x(t.parentNode,e,n)}function j(t,n){t.forEach(function(r){if("function"===e(r))r(n);else{if("function"!==e(r.handleEvent))throw new Error("[DOMDelegator callListeners] unknown handler found: "+JSON.stringify(t));r.handleEvent(n)}})}function O(t,e,n){return arguments.length>2?t.get(e,n):t.get(e)}function N(t,e,n,r){var o=t[e]||[];return 0===o.length&&n.listenTo(e),o.indexOf(r)===-1&&o.push(r),t[e]=o,r}function T(t,e,n,r){var o=t[e];if(!o||0===o.length||3===arguments.length)return o&&o.length&&n.unlistenTo(e),delete t[e],r;var i=o.indexOf(r);return i!==-1&&o.splice(i,1),t[e]=o,0===o.length&&(n.unlistenTo(e),delete t[e]),r}function D(t,e){return Object.keys(t).forEach(function(n){T(t,n,e)}),t}function A(t,e,n){return t.addEventListener(e,n,!0)}function P(t,e,n){return t.removeEventListener(e,n,!0)}function M(t){return!this instanceof M?new M(t):(this.init(t),void(Mt.test(t.type)?C(this,t,"key"):Ct.test(t.type)&&C(this,t,"mouse")))}function C(t,e,n){for(var r=Pt[n],o=0,i=r.length;o<i;o++){var a=r[o];t[a]=e[a]}}function R(t,e){e=e||[],e=[].concat(e);for(var n=t.length-1;n>-1;n--)if(t[n]&&t[n].parentNode){e[n]&&S(e[n]),Lt.off(t[n]),St.remove(t[n]);try{t[n].parentNode.removeChild(t[n])}catch(r){}}0!=t.length&&(t.length=0)}function S(n){if(n.configContext&&"function"===e(n.configContext.onunload)&&(n.configContext.onunload(),n.configContext.onunload=null),n.controllers){for(var r=0,o=n.controllers.length;r<o;r++){var i=n.controllers[r];"function"===e(i.onunload)&&(i.onunload({preventDefault:t}),_t.unloaders.remove(i))}n.controllers.length=0,n.views&&n.views.length&&(n.views.length=0),delete n.componentName}if(n.children)if("array"===e(n.children))for(var a=0,s=n.children.length;a<s;a++){var l=n.children[a];S(l)}else n.children.tag&&S(n.children)}function L(t,n,r,o,i){return Object.keys(r).forEach(function(a){var s,l=r[a],u=o[a];if(a in o&&u===l)"value"===a&&"input"===n&&t.value!=l&&(t.value=l);else{o[a]=l;try{if("config"===a||"key"==a)return;if("function"===e(l)&&0===a.indexOf("on"))t[a]=l;else if((s=c(a,It))&&s[1].length){var h=s[1].toLowerCase();Ft.off(t,h),F(l)&&Ft.on(t,h,l)}else"style"===a&&null!=l&&"object"===e(l)?(Object.keys(l).forEach(function(e){null!=u&&u[e]===l[e]||(t.style[e]=l[e])}),"object"===e(u)&&Object.keys(u).forEach(function(e){e in l||(t.style[e]="")})):null!=i?"href"===a?t.setAttributeNS("http://www.w3.org/1999/xlink","href",l):"className"===a?t.setAttribute("class",l):t.setAttribute(a,l):a in t&&"list"!==a&&"style"!==a&&"form"!==a&&"type"!==a&&"width"!==a&&"height"!==a?"input"===n&&t[a]===l||(t[a]=l):t.setAttribute(a,l)}catch(f){if(f.message.indexOf("Invalid argument")<0)throw f}}}),o}function F(t){return"function"===e(t)||t&&"function"===e(t.handleEvent)}function I(t,n,r,o,i,a,s,l,u,c,h){try{null!=i&&null!=i.toString()||(i="")}catch(f){i=""}if("retain"===i.subtree)return a;var d,p=e(a),v=e(i);return null!=a&&p===v||(a=H(i,a,l,o,r,v)),"array"===v?(i=K(i),d=a.length===i.length,a=q(i,a,t),a=B(i,a,t,n,l,s,d,u,c,h)):null!=i&&"object"===v?a=W(i,a,t,l,s,u,c,h):"function"!==e(i)&&(a=U(i,a,t,n,l,s,u)),a}function H(t,e,n,r,o,i){var a,s;return null!=e&&(o&&o.nodes?(a=n-r,s=a+("array"===i?t:e.nodes).length,R(o.nodes.slice(a,s),o.slice(a,s))):e.nodes&&R(e.nodes,e)),e=new t.constructor,e.tag&&(e={}),e.nodes=[],e}function q(t,n,r){function o(t){return"string"===e(t)||"number"===e(t)&&"NaN"!==e(t)}function i(t){return t&&t.attrs&&o(t.attrs.key)?t.attrs.key:void 0}function a(t,e){t&&t.attrs&&(void 0===e?delete t.attrs.key:t.attrs.key=e)}function s(){return t.length!==n.length||t.some(function(t,e){var r=n[e];return i(r)!==i(t)})}function l(t,e){var r=i(t);if(void 0!==r)if(d[r]){var o=d[r].index;d[r]={action:f,index:e,from:o,element:n.nodes[o]||kt.createElement("div")}}else d[r]={action:h,index:e}}function u(e,o){var i=e.index,a=e.action;if(a===c&&(R(n[i].nodes,n[i]),o.splice(i,1)),a===h){var s=kt.createElement("div");s.setAttribute("data-mref",i);var l=t[i].attrs.key;r.insertBefore(s,r.childNodes[i]||null),o.splice(i,0,{attrs:{key:l},nodes:[s]}),o.nodes[i]=s}a===f&&(e.element.setAttribute("data-mref",i),r.childNodes[i]!==e.element&&null!==e.element&&r.insertBefore(e.element,r.childNodes[i]||null),o[i]=n[e.from],o.nodes[i]=e.element)}var c=1,h=2,f=3,d={},p=!1;n.forEach(function(t,e){var n=i(t);a(t,n),void 0!==n&&(p=!0,d[n]={action:c,index:e})});var v=0;if(t.some(function(t,e){if(t&&"retain"===t.subtree){var r=i(n[e]);null!=r&&(t.attrs={key:r})}var o=i(t);return a(t,o),void 0!==o})&&t.forEach(function(t){t&&t.attrs&&null==t.attrs.key&&(t.attrs.key="__m-react__"+v++)}),p&&s()){t.forEach(l);var g=void 0,m=new Array(n.length);g=Object.keys(d).map(function(t){return d[t]}).sort(function(t,e){return t.action-e.action||t.index-e.index}),m.nodes=n.nodes.slice();for(var y=0,w=g.length;y<w;y++)u(g[y],m);n=m}return n}function B(t,n,r,o,i,a,s,l,u,c){function h(t){var h=I(r,o,n,i,t,n[d],a,i+f||f,l,u,c);void 0!==h&&(h.nodes.intact||(s=!1),f+=h.$trusted?(h.match(/<[^\/]|\>\s*[^<]/g)||[0]).length:"array"===e(h)?h.length:1,n[d++]=h)}var f=0,d=0,p=[];if(t.forEach(h),!s){for(var v=0,g=t.length;v<g;v++)null!=n[v]&&p.push.apply(p,n[v].nodes);for(var m,y=0;m=n.nodes[y];y++)null!=m.parentNode&&p.indexOf(m)<0&&R([m],[n[y]]);t.length<n.length&&(n.length=t.length),n.nodes=p}return n}function W(n,r,o,i,a,s,l,u){for(var c,h,f=[],d=[];n.view;){var p=n.view,v=n.view.$original||p,g=r.views?r.views.indexOf(v):-1,m=g>-1?r.controllers[g]:new(n.controller||t),y=m.instance;"object"==typeof y&&(c=y.name,"object"==typeof y.cached&&(h=y.cached),y.viewFn=[p,m]);var w=n&&n.attrs&&n.attrs.key;if(n=n.view(m),"retain"===n.subtree)return h?h:r;null!=w&&(n.attrs||(n.attrs={}),n.attrs.key=w),m.onunload&&_t.unloaders.set(m,m.onunload),f.push(v),d.push(m)}if(!n.tag&&d.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");if(n.attrs||(n.attrs={}),null!=h&&(r=h),r.attrs||(r.attrs={}),(n.tag!=r.tag||!Y(n.attrs,r.attrs)||n.attrs.id!=r.attrs.id||n.attrs.key!=r.attrs.key||"string"===e(c)&&r.componentName!=c)&&r.nodes.length&&R(r.nodes,r),"string"!==e(n.tag))return r;var b,k,E=0===r.nodes.length,_=Object.keys(n.attrs),x=_.length>("key"in n.attrs?1:0);if(n.attrs.xmlns?l=n.attrs.xmlns:"svg"===n.tag?l="http://www.w3.org/2000/svg":"math"===n.tag&&(l="http://www.w3.org/1998/Math/MathML"),E){var j=V(o,l,n,i);b=j[0],k=j[1],r={tag:n.tag,attrs:x?L(b,n.tag,n.attrs,{},l):n.attrs,children:null!=n.children&&n.children.length>0?I(b,n.tag,void 0,void 0,n.children,r.children,!0,0,n.attrs.contenteditable?b:s,l,u):n.children,nodes:[b]},d.length&&(r.views=f,r.controllers=d),r.children&&!r.children.nodes&&(r.children.nodes=[]),"select"===n.tag&&"value"in n.attrs&&L(b,n.tag,{value:n.attrs.value},{},l),null!=k&&o.insertBefore(b,o.childNodes[k]||null)}else b=r.nodes[0],x&&L(b,n.tag,n.attrs,r.attrs,l),r.children=I(b,n.tag,void 0,void 0,n.children,r.children,!1,0,n.attrs.contenteditable?b:s,l,u),r.nodes.intact=!0,d.length&&(r.views=f,r.controllers=d),a===!0&&null!=b&&o.insertBefore(b,o.childNodes[i]||null);if("string"===e(c)&&(r.componentName=c),"function"===e(n.attrs.config)){var O=r.configContext=r.configContext||{},N=function(t){return function(){return n.attrs.config.apply(n,t)}};u.push(N([b,!E,O,r,[o,i,s,l]]))}return r}function V(t,e,n,r){var o,i=r;if(t&&t.childNodes.length){var a=$(t,r);if(o=a[0],i=a[1],o){if(o.tagName.toLowerCase()==n.tag.toLowerCase()&&o.id==n.attrs.id)return[o,null];R([o])}}return o=n.attrs.is?void 0===e?kt.createElement(n.tag,n.attrs.is):kt.createElementNS(e,n.tag,n.attrs.is):void 0===e?kt.createElement(n.tag):kt.createElementNS(e,n.tag),o.setAttribute("data-mref",r),[o,i]}function $(t,e){for(var n,r=0,o=t.childNodes.length;r<o;r++)if(n=t.childNodes[r],n.getAttribute&&n.getAttribute("data-mref")==e)return[n,r];return[null,e]}function U(t,e,n,r,o,i,a){var s;if(0===e.nodes.length){if(""==t)return e;R([n.childNodes[o]]),t.$trusted?s=Q(n,o,t):(s=[kt.createTextNode(t)],n.nodeName.match(Ht)||n.insertBefore(s[0],n.childNodes[o]||null)),e="string number boolean".indexOf(typeof t)>-1?new t.constructor(t):t,e.nodes=s}else e.valueOf()!==t.valueOf()||i===!0?(s=e.nodes,a&&a===kt.activeElement||(t.$trusted?(R(s,e),s=Q(n,o,t)):"textarea"===r?n.value=t:a?a.innerHTML=t:((1===s[0].nodeType||s.length>1)&&(R(e.nodes,e),s=[kt.createTextNode(t)]),n.insertBefore(s[0],n.childNodes[o]||null),s[0].nodeValue=t)),e=new t.constructor(t),e.nodes=s):e.nodes.intact=!0;return e}function K(t){for(var n=0;n<t.length;n++)"array"===e(t[n])&&(t=t.concat.apply([],t),n--);return t}function Y(t,e){var n=Object.keys(t).sort().join(),r=Object.keys(e).sort().join();return n===r}function Q(t,e,n){var r=t.childNodes[e];if(r){var o=1!==r.nodeType,i=kt.createElement("span");o?(t.insertBefore(i,r||null),i.insertAdjacentHTML("beforebegin",n),t.removeChild(i)):r.insertAdjacentHTML("beforebegin",n)}else t.insertAdjacentHTML("beforeend",n);for(var a,s=[];(a=t.childNodes[e++])!==r;)s.push(a);return s}function X(t,e,n,r){var o={root:t,vNode:e,forceRecreation:n};return r===!0?G(o):void _t.renderQueue.addTarget({mergeType:1,root:t,processor:G,params:[o]})}function G(t){var e=t.root,n=t.vNode,r=t.forceRecreation;if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var o,i=[],a=e===kt||e===kt.documentElement,s=a?qt:e;a&&"html"!==n.tag&&(n={tag:"html",attrs:{},children:n}),r&&Z(s),o=I(s,null,void 0,void 0,n,Bt.get(s),!1,0,null,void 0,i),i.forEach(function(t){t()}),Bt.set(s,o)}function Z(t){R(t.childNodes,Bt.get(t)),Bt.remove(t)}function z(t){Vt!==!0&&(Vt=!0,t===!0&&(_t.forcing=!0),J(t),Vt=!1)}function J(t){var n,r,o,i;0!==Wt.length()&&t!==!0||"function"===e(_t.computePreRedrawHook)&&(_t.computePreRedrawHook(),_t.computePreRedrawHook=null),Wt.length()>0&&Wt.stop();for(var a=0,s=_t.roots.length;a<s;a++)n=_t.roots[a],r=_t.components[a],o=_t.controllers[a],i=_t.recreations[a],o&&("object"==typeof o.instance&&(o.instance.viewFn=[r.view,o]),X(n,r.view?r.view(o):"",i,t)),_t.recreations[a]=void 0;t===!0&&(tt(),_t.forcing=!1)}function tt(){"function"===e(_t.computePostRedrawHook)&&(_t.computePostRedrawHook(),_t.computePostRedrawHook=null)}function et(t){var e=t.processor,n=t.params;"function"==typeof e&&e.apply(null,n)}function nt(t,e){var n,r,o,i;for(n=0,r=t.length;n<r;n++)if(i=rt(t[n],e)){o=n;break}return o>-1?(t.splice(o,1),t.push(i)):t.push(e),t}function rt(t,e){var n=t.root,r=e.root;if(t.mergeType|e.mergeType)return n===r?e:null;var o=h(n,r);return o?o===n?t:e:null}function ot(n,r,o,i){if(!n)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var a=_t.roots.indexOf(n);a<0&&(a=_t.roots.length),_t.unloaders.each(function(t,e){t.call(e),e.onunload=null}),_t.unloaders.clear(),_t.controllers[a]&&"function"===e(_t.controllers[a].onunload)&&_t.controllers[a].onunload(),_t.roots[a]=n;var s=$t=r=r||{controller:t},l=r.controller||t,u=new l;return s===$t&&(_t.controllers[a]=u,_t.components[a]=r,_t.recreations[a]=o),z(i),_t.controllers[a]}function it(t){var e=t.viewFn,n=e[0](e[1]),r=t.props.key,o=t.redrawData,i=o[0],a=o[1],s=o[2],l=o[3],u=[];null!=r&&(n.attrs=n.attrs||{},n.attrs.key=r),t.cached=I(i,null,void 0,void 0,n,t.cached,!1,a,s,l,u);for(var c=0,h=u.length;c<h;c++)u[c]()}function at(t,e){var n=a(i(e));return Object(t)!==t?n:(Object.keys(t).forEach(function(e){var r=t[e],o=n[e];void 0===o&&(n[e]=r)}),n)}function st(t,n){if("object"!==e(t))throw new TypeError("[createComponent]param should be a object! given: "+t);n&&(t.mixins=[].concat(n,t.mixins).filter(Boolean));var r={},o=ut(t);return r.controller=function(t,n){var r=new o(t,n),i={instance:r,_cachedValue:{}};return i.onunload=r.onunload.bind(r,r.componentWillUnmount),"string"===e(r.name)&&(i.name=r.name),i},r.view=ct(),r}function lt(t,r){var o;for("array"!==e(r)&&(r=n(arguments,1)),r=r.filter(function(t){return"object"===e(t)});r.length>0;)o=r.shift(),Object.keys(o).forEach(function(n){if("mixins"===n)return void(r=dt([].concat(o[n]),r));if(Qt.indexOf(n)===-1)return Kt.indexOf(n)!==-1?void("array"===e(t[n])?t[n].push(o[n]):t[n]="function"===e(t[n])?[t[n],o[n]]:[o[n]]):void(t[n]=o[n])});Kt.forEach(function(n){if("array"===e(t[n])){var r=t[n].filter(function(t){return"function"===e(t)});t[n]=pt(Yt.indexOf(n)!==-1,r)}})}function ut(t){var e,n=function(){Xt.apply(this,arguments),ht(n.prototype,this)};return n.prototype=Object.create(Xt.prototype),e=t.mixins||[],delete t.mixins,e=[].concat(e,t),lt(n.prototype,e),n.prototype._ctor=n.prototype,n}function ct(){return function(t,n,r){var o=t.instance,i=t._cachedValue.props,a=t._cachedValue.state,s=t._cachedValue.prevProps!==n,l=function(t,n,r,s,l){ft(o,"setInternalProps",t,s,l),n?ft(o,"componentDidUpdate",t,i,a):(ft(o,"componentDidMount",t),"function"===e(o.componentWillDetached)&&(r.onunload=o.componentWillDetached.bind(o,t)))};if(t._cachedValue.prevProps=n,o.setProps(n,r,s),t._cachedValue.props=o.props,t._cachedValue.state=o.state,null!=o.root){if(ft(o,"shouldComponentUpdate",i,a)===!1)return{subtree:"retain"};ft(o,"componentWillUpdate",o.root,i,a)}else ft(o,"componentWillMount",i,a);var u=ft(o,"render",o.props,o.state);return u.attrs=u.attrs||{},u.attrs.config=l,u}}function ht(t,n){Object.keys(t).forEach(function(r){var o=t[r];("function"===e(o)||/^on[A-Z]\w*/.test(r))&&(n[r]=o.bind(n))})}function ft(t,r){var o=n(arguments,2);if("function"===e(t[r]))return t[r].apply(t,o)}function dt(t,n){var r,o,i=t.length;for(r=0;r<i;r++)o=t[r],"object"===e(o)&&n.indexOf(o)===-1&&n.unshift(o);return n}function pt(t,e){return function(){for(var r,o=n(arguments,0),i=this,a=0,s=e.length,l=o;a<s;a++)r=e[a],l=r.apply(i,o),o=t?[l]:o;return l}}var vt=/^\[object (\w+)\]$/,gt=Array.prototype.slice,mt=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,yt=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/;g.trust=function(t){return t=new String(t),t.$trusted=!0,t},m.prototype.addTarget=function(t){var n=this._queue.length;return"function"===e(this.options.onAddTarget)?this._queue=this.options.onAddTarget.call(this,this._queue,t):this._queue.push(t),0===n&&1===this._queue.length&&this.scheduleFlush(),this},m.prototype.removeTarget=function(t){var e=this._queue.indexOf(t);return e!==-1&&this._queue.splice(e,1),this},m.prototype.flush=function(){for(var t,n,r=new Date,o=this._cb;this._queue.length;){n=this._queue.shift();try{o.call(null,n)}catch(i){console[console.error?"error":"log"](i),console.log(i.stack)}if(t=new Date-r,t>jt)break}this._queue.length?this.scheduleFlush():"function"===e(this.options.onFinish)&&this.options.onFinish.call(null)},m.prototype.scheduleFlush=function(){return this._tick&&Tt(this._tick),this._tick=Nt(this.flush),this._tick},m.prototype.onFlush=function(t){if("function"!==e(t))throw new TypeError("[Batch.prototype.onFlush]need a Function here, but given "+t);return this._cb=t,this},m.prototype.length=function(){return this._queue.length},m.prototype.stop=function(){return Tt(this._tick),this._queue.length=0,this},["onAddTarget","onFinish"].forEach(function(t){m.prototype[t]=function(n){if("function"!==e(n))throw new TypeError("[Batch.prototype."+t+"]need a Function here, but given "+n);return this.options[t]=n,this}}),y.prototype={has:function(t){b(t);var e,n=this._keys;if(t!=t||0===t)for(e=n.length;e--&&!w(n[e],t););else e=n.indexOf(t);return this._index=e,e>-1},clear:function(){this._keys.length=0,this._values.length=0,this._index=-1},set:function(t,e){return this.has(t)?this._values[this._index]=e:this._values[this._keys.push(t)-1]=e,this},get:function(t,e){return this.has(t)?this._values[this._index]:(arguments.length>1&&this.set(t,e),e)},remove:function(t){var e;return this.has(t)&&(e=this._index,this._keys.splice(e,1),this._values.splice(e,1)),e>-1},each:function(t){if("function"==typeof t)for(var e=0,n=this._keys.length;e<n;e++)t(this._values[e],this._keys[e])}};var wt=k.prototype;wt.on=function(e,n,r){"click"===n&&(e.onclick=t);var o=O(this.domEvHandlerMap,e,u());return N(o,n,this,r),this},wt.off=function(t,e,n){var r=O(this.domEvHandlerMap,t);return r?(arguments.length>=3?T(r,e,this,n):2===arguments.length?T(r,e,this):D(r,this),(arguments.length<2||"click"===e)&&(t.onclick=null),0===Object.keys(r).length&&this.domEvHandlerMap.remove(t),this):this},wt.addGlobalEventListener=function(t,e){return N(this.globalListeners,t,this,e),this},wt.removeGlobalEventListener=function(t,e){return arguments.length>=2?T(this.globalListeners,t,this,e):1===arguments.length?T(this.globalListeners,t,this):D(this.globalListeners,this),this},wt.destroy=function(){this.unlistenTo(),this.listenedEvents=null,this.eventDispatchers=null,this.globalListeners=null,this.domEvHandlerMap.clear()},wt.listenTo=function(t){if(t in this.listenedEvents||(this.listenedEvents[t]=0),this.listenedEvents[t]++,1!==this.listenedEvents[t])return this;var e=this.eventDispatchers[t];return e||(e=this.eventDispatchers[t]=E(t,this)),A(this.root,t,e),this},wt.unlistenTo=function(t){var e=this.eventDispatchers,n=this;if(0===arguments.length)return Object.keys(e).filter(function(t){var n=!!e[t];return n&&(e[t]=1),n}).forEach(function(t){n.unlistenTo(t)}),this;if(!(t in this.listenedEvents)||0===this.listenedEvents[t])return console.log('[DOMDelegator unlistenTo]event "'+t+'" is already unlistened!'),this;if(this.listenedEvents[t]--,this.listenedEvents[t]>0)return this;var r=this.eventDispatchers[t];if(!r)throw new Error("[DOMDelegator unlistenTo]: cannot unlisten to "+t);return P(this.root,t,r),this};for(var bt="undefined"!=typeof window?window:{},kt=bt.document,Et="undefined"==typeof process||process.browser?"undefined"!=typeof window?"browser":"unknown":"nodejs",_t={forcing:!1,unloaders:new y,computePreRedrawHook:null,computePostRedrawHook:null,roots:[],recreations:[],components:[],controllers:[],domCacheMap:new y,domDelegator:new k,renderQueue:new m},xt=0,jt=16,Ot=["webkit","moz","ms","o"],Nt=bt.requestAnimationFrame,Tt=bt.cancelAnimationFrame||bt.cancelRequestAnimationFrame,Dt=0,At=Ot.length;Dt<At&&!Nt;++Dt)Nt=bt[Ot[Dt]+"RequestAnimationFrame"],Tt=bt[Ot[Dt]+"CancelAnimationFrame"]||bt[Ot[Dt]+"CancelRequestAnimationFrame"];Nt||(Nt=function(t){var e=Date.now?Date.now():(new Date).getTime(),n=Math.max(0,jt-(e-xt)),r=setTimeout(function(){t(e+n)},n);return xt=e+n,r}),Tt||(Tt=function(t){return clearTimeout(t)});var Pt={all:["altKey","bubbles","cancelable","ctrlKey","eventPhase","metaKey","relatedTarget","shiftKey","target","timeStamp","type","view","which"],mouse:["button","buttons","clientX","clientY","layerX","layerY","offsetX","offsetY","pageX","pageY","screenX","screenY","toElement"],key:["char","charCode","key","keyCode"]},Mt=/^key|input/,Ct=/^(?:mouse|pointer|contextmenu)|click/;M.prototype=i(M.prototype,{init:function(t){C(this,t,"all"),this.originalEvent=t,this._bubbles=!1},preventDefault:function(){return this.originalEvent.preventDefault()},startPropagation:function(){this._bubbles=!0}});var Rt,St=_t.domCacheMap,Lt=_t.domDelegator,Ft=_t.domDelegator,It=/^ev([A-Z]\w*)/,Ht=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/,qt={appendChild:function(t){void 0===Rt&&(Rt=kt.createElement("html")),kt.documentElement&&kt.documentElement!==t?kt.replaceChild(t,kt.documentElement):kt.appendChild(t),this.childNodes=kt.childNodes},insertBefore:function(t){this.appendChild(t)},childNodes:[]},Bt=_t.domCacheMap,Wt=_t.renderQueue.onFinish(tt),Vt=!1;_t.renderQueue.onFlush(et).onAddTarget(nt);var $t,Ut=(function(){var t="function"==typeof Symbol&&Symbol["for"]&&Symbol["for"]("react.element")||60103;return function(e,n,r,o){var i=e&&e.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&i)for(var s in i)void 0===n[s]&&(n[s]=i[s]);else n||(n=i||{});if(1===a)n.children=o;else if(a>1){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+3];n.children=l}return{$$typeof:t,type:e,key:void 0===r?null:""+r,ref:null,props:n,_owner:null}}}(),function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,o){var s={key:t,arg:e,resolve:n,reject:o,next:null};a?a=a.next=s:(i=a=s,r(t,e))})}function r(n,i){try{var a=e[n](i),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){r("next",t)},function(t){r("throw",t)}):o(a.done?"return":"normal",a.value)}catch(l){o("throw",l)}}function o(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}i=i.next,i?r(i.key,i.arg):a=null}var i,a;this._invoke=n,"function"!=typeof e["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype["throw"]=function(t){return this._invoke("throw",t)},e.prototype["return"]=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),Kt=(function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(l){o=!0,i=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),["componentWillMount","componentDidMount","componentWillUpdate","componentDidUpdate","componentWillUnmount","componentWillDetached","componentWillReceiveProps","getInitialProps","getInitialState"]),Yt=["getInitialProps","getInitialState","componentWillReceiveProps"],Qt=["setState","mixins","onunload","setInternalProps","redraw","setProps"],Xt=function(){function t(n,r){if(Ut(this,t),"object"!==e(n)&&null!=n)throw new TypeError("[Component]param for constructor should a object or null or undefined! given: "+n);this.props=at(this.defaultProps,n),this.props.children=l(r),this.root=null,this.getInitialProps&&(this.props=this.getInitialProps(this.props)),this.getInitialState&&(this.state=this.getInitialState(this.props))}return t.prototype.setProps=function(t,n,r){"object"!==e(t)&&(t={}),r&&this.componentWillReceiveProps&&(t=this.componentWillReceiveProps(t)),this.props=at(this.defaultProps,t),this.props.children=l(n)},t.prototype.onunload=function(t){"function"===e(t)&&t.call(this),this.root=null,this.cached=null,this.redrawData=null},t.prototype.setInternalProps=function(t,e,n){this.root=t,this.cached=e,this.redrawData=n},t.prototype.redraw=function(){if(null!=this.redrawData){var t=this;_t.renderQueue.addTarget({mergeType:0,processor:it,root:t.root,params:[t]})}},t.prototype.setState=function(t,e){null==this.state&&(this.state={}),this.state=i(this.state,t),e||"browser"!==Et||this.redraw()},t}(),Gt=g;return Gt.render=X,Gt.redraw=z,Gt.mount=ot,Gt.component=d,Gt.createComponent=st,Gt.domDelegator=_t.domDelegator,"undefined"==typeof Object.assign&&(Object.assign=o),Gt});