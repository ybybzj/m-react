!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("m-react",e):t.mReact=e()}(this,function(){"use strict";function t(){}function e(t){if(null===t)return"null";if(void 0===t)return"undefined";if(t!==t)return"NaN";var e=Object.prototype.toString.call(t).match(gt);return null==e?"unknown":e[1].toLowerCase()}function n(){return mt.apply(arguments[0],mt.call(arguments,1))}function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function o(){for(var t,e,n,o=arguments.length,i=0;o>i&&(n=arguments[i],n!==Object(n));)i++;if(i===o)return{};for(i++;o>i;)if(e=arguments[i++],e===Object(e))for(t in e)r(e,t)&&(n[t]=e[t]);return n}function i(){var t=n(arguments);return o.apply(null,[{}].concat(t))}function s(t){if("object"!==e(t))throw new TypeError("[removeVoidValue]param should be a object! given: "+t);var n={};return Object.keys(t).forEach(function(e){void 0!==t[e]&&(n[e]=t[e])}),n}function a(t){for(var n=[],r=!0,o=0,i=t.length;i>o;o++){var s=t[o];if("array"!==e(s)){r=!1;break}n.push(s)}return n=r===!1||0===t.length?t:[].concat.apply([],n)}function l(t){switch(e(t)){case"undefined":case"null":return[];case"array":return a(t);default:return[t]}}function u(){return Object.create(null)}function c(t,n){return"string"!==e(t)||"regexp"!==e(n)?null:t.match(n)}function h(t,e){if(t===e)return e;var n=t.compareDocumentPosition(e);return 24&n?16&n?t:e:null}function f(e,r){var o=function(){return(e.controller||t).apply(this,r)||this};e.controller&&(o.prototype=e.controller.prototype);var i=function(t){return arguments.length>1&&(r=r.concat(n(arguments,1))),e.view.apply(e,r.length?[t].concat(r):[t])};i.$original=e.view;var s={controller:o,view:i};return r[0]&&null!=r[0].key&&(s.attrs={key:r[0].key}),s}function d(t){return f(t,n(arguments,1))}function p(t){return"object"===e(t)&&"function"===e(t.controller)&&"function"===e(t.view)}function v(){var t=arguments[0],r=arguments[1],o=n(arguments,2);if(p(t))return d(t,r,o);if("string"!==e(t))throw new Error("selector in m(selector, attrs, children) should be a string");var i,s,a,l=!(null==r||"object"!==e(r)||"tag"in r||"view"in r||"subtree"in r),u={tag:"div",attrs:{}},c=[];r=l?r:{},a="class"in r?"class":"className",o=l?o:n(arguments,1),u.children="array"===e(o[0])?o[0]:o;for(;i=yt.exec(t);)""===i[1]&&i[2]?u.tag=i[2]:"#"===i[1]?u.attrs.id=i[2]:"."===i[1]?c.push(i[2]):"["===i[3][0]&&(s=wt.exec(i[3]),u.attrs[s[1]]=s[3]||(s[2]?"":!0));return Object.keys(r).forEach(function(t){var n=r[t];t===a&&"string"===e(n)&&""!==n.trim()?(c.push(n),u.attrs[t]=""):u.attrs[t]=n}),c.length>0&&(u.attrs[a]=c.join(" ")),u}function g(n){this.options=n||{};var r=this.options.onFlush;this._cb="function"===e(r)?r:t,this._queue=[],this._startPos=0,this.flush=this.flush.bind(this)}function m(){return!this instanceof m?new m:(this._index=-1,this._keys=[],void(this._values=[]))}function y(t,e){return isNaN(t)?isNaN(e):t===e}function w(t){if(t!==Object(t))throw new TypeError("[Map]Invalid value used as a map key! given: "+t)}function b(t){if(!this instanceof b)return new b(t);if(t=t||kt||{documentElement:1},!t.documentElement)throw new Error('[DOMDelegator]Invalid parameter "doc", should be a document object! given: '+t);this.root=t.documentElement,this.listenedEvents=u(),this.eventDispatchers=u(),this.globalListeners=u(),this.domEvHandlerMap=new m}function E(t,e){var n=e.globalListeners,r=e.root;return function(o){var i=n[t]||[];if(i&&i.length>0){var s=new P(o);s.target=r,j(i,s)}k(o.target,o,t,e)}}function k(t,e,n,r){var o=_(t,n,r);if(o&&o.handlers.length>0){var i=new P(e);i.currentTarget=o.currentTarget,j(o.handlers,i),i._bubbles&&k(o.currentTarget.parentNode,e,n,r)}}function _(t,e,n){if(null==t)return null;var r,o=O(n.domEvHandlerMap,t);return o&&(r=o[e])&&0!==r.length?{currentTarget:t,handlers:r}:_(t.parentNode,e,n)}function j(t,n){t.forEach(function(r){if("function"===e(r))r(n);else{if("function"!==e(r.handleEvent))throw new Error("[DOMDelegator callListeners] unknown handler found: "+JSON.stringify(t));r.handleEvent(n)}})}function O(t,e,n){return arguments.length>2?t.get(e,n):t.get(e)}function x(t,e,n,r){var o=t[e]||[];return 0===o.length&&n.listenTo(e),-1===o.indexOf(r)&&o.push(r),t[e]=o,r}function N(t,e,n,r){var o=t[e];if(!o||0===o.length||3===arguments.length)return o&&o.length&&n.unlistenTo(e),delete t[e],r;var i=o.indexOf(r);return-1!==i&&o.splice(i,1),t[e]=o,0===o.length&&(n.unlistenTo(e),delete t[e]),r}function T(t,e){return Object.keys(t).forEach(function(n){N(t,n,e)}),t}function D(t,e,n){return t.addEventListener(e,n,!0)}function C(t,e,n){return t.removeEventListener(e,n,!0)}function P(t){return!this instanceof P?new P(t):(this.init(t),void(Mt.test(t.type)?A(this,t,"key"):Rt.test(t.type)&&A(this,t,"mouse")))}function A(t,e,n){for(var r=At[n],o=0,i=r.length;i>o;o++){var s=r[o];t[s]=e[s]}}function M(t,e){e=e||[],e=[].concat(e);for(var n=t.length-1;n>-1;n--)if(t[n]&&t[n].parentNode){e[n]&&R(e[n]),Ht.off(t[n]),Ft.remove(t[n]);try{t[n].parentNode.removeChild(t[n])}catch(r){}}0!=t.length&&(t.length=0)}function R(n){if(n.configContext&&"function"===e(n.configContext.onunload)&&(n.configContext.onunload(),n.configContext.onunload=null),n.controllers)for(var r=0,o=n.controllers.length;o>r;r++){var i=n.controllers[r];"function"===e(i.onunload)&&(i.onunload({preventDefault:t}),jt.unloaders.remove(i))}if(n.children)if("array"===e(n.children))for(var r=0,o=n.children.length;o>r;r++){var s=n.children[r];R(s)}else n.children.tag&&R(n.children)}function L(t,n,r,o,i){return Object.keys(r).forEach(function(s){var a,l=r[s],u=o[s];if(s in o&&u===l)"value"===s&&"input"===n&&t.value!=l&&(t.value=l);else{o[s]=l;try{if("config"===s||"key"==s)return;if("function"===e(l)&&0===s.indexOf("on"))t[s]=l;else if((a=c(s,It))&&a[1].length){var h=a[1].toLowerCase();qt.off(t,h),F(l)&&qt.on(t,h,l)}else"style"===s&&null!=l&&"object"===e(l)?(Object.keys(l).forEach(function(e){(null==u||u[e]!==l[e])&&(t.style[e]=l[e])}),"object"===e(u)&&Object.keys(u).forEach(function(e){e in l||(t.style[e]="")})):null!=i?"href"===s?t.setAttributeNS("http://www.w3.org/1999/xlink","href",l):"className"===s?t.setAttribute("class",l):t.setAttribute(s,l):s in t&&"list"!==s&&"style"!==s&&"form"!==s&&"type"!==s&&"width"!==s&&"height"!==s?("input"!==n||t[s]!==l)&&(t[s]=l):t.setAttribute(s,l)}catch(f){if(f.message.indexOf("Invalid argument")<0)throw f}}}),o}function F(t){return"function"===e(t)||t&&"function"===e(t.handleEvent)}function H(t,n,r,o,i,s,a,l,u,c,h){try{(null==i||null==i.toString())&&(i="")}catch(f){i=""}if("retain"===i.subtree)return s;var d,p=e(s),v=e(i);return(null==s||p!==v)&&(s=q(i,s,l,o,r,v)),"array"===v?(i=$(i),d=s.length===i.length,s=I(i,s,t),s=S(i,s,t,n,l,a,d,u,c,h)):null!=i&&"object"===v?s=B(i,s,t,l,a,u,c,h):"function"!==e(i)&&(s=V(i,s,t,n,l,a,u)),s}function q(t,e,n,r,o,i){var s,a;return null!=e&&(o&&o.nodes?(s=n-r,a=s+("array"===i?t:e.nodes).length,M(o.nodes.slice(s,a),o.slice(s,a))):e.nodes&&M(e.nodes,e)),e=new t.constructor,e.tag&&(e={}),e.nodes=[],e}function I(t,n,r){function o(t){return"string"===e(t)||"number"===e(t)&&"NaN"!==e(t)}function i(t){return t&&t.attrs&&o(t.attrs.key)?t.attrs.key:void 0}function s(t,e){t&&t.attrs&&(void 0===e?delete t.attrs.key:t.attrs.key=e)}function a(){return t.length!==n.length?!0:t.some(function(t,e){var r=n[e];return r.attrs&&t.attrs&&r.attrs.key!==t.attrs.key})}function l(t,e){var r=i(t);if(void 0!==r)if(d[r]){var o=d[r].index;d[r]={action:f,index:e,from:o,element:n.nodes[o]||kt.createElement("div")}}else d[r]={action:h,index:e}}function u(e,o){var i=e.index,s=e.action;if(s===c&&(M(n[i].nodes,n[i]),o.splice(i,1)),s===h){var a=kt.createElement("div");a.setAttribute("data-mref",i);var l=t[i].attrs.key;r.insertBefore(a,r.childNodes[i]||null),o.splice(i,0,{attrs:{key:l},nodes:[a]}),o.nodes[i]=a}s===f&&(e.element.setAttribute("data-mref",i),r.childNodes[i]!==e.element&&null!==e.element&&r.insertBefore(e.element,r.childNodes[i]||null),o[i]=n[e.from],o.nodes[i]=e.element)}var c=1,h=2,f=3,d={},p=!1;n.forEach(function(t,e){var n=i(t);s(t,n),void 0!==n&&(p=!0,d[n]={action:c,index:e})});var v=0;if(t.some(function(t){var e=i(t);return s(t,e),void 0!==e})&&t.forEach(function(t){t&&t.attrs&&null==t.attrs.key&&(t.attrs.key="__m-react__"+v++)}),p&&a()){t.forEach(l);var g=void 0,m=new Array(n.length);g=Object.keys(d).map(function(t){return d[t]}).sort(function(t,e){return t.action-e.action||t.index-e.index}),m.nodes=n.nodes.slice();for(var y=0,w=g.length;w>y;y++)u(g[y],m);n=m}return n}function S(t,n,r,o,i,s,a,l,u,c){function h(t){var h=H(r,o,n,i,t,n[d],s,i+f||f,l,u,c);void 0!==h&&(h.nodes.intact||(a=!1),f+=h.$trusted?(h.match(/<[^\/]|\>\s*[^<]/g)||[0]).length:"array"===e(h)?h.length:1,n[d++]=h)}var f=0,d=0,p=[];if(t.forEach(h),!a){for(var v=0,g=t.length;g>v;v++)null!=n[v]&&p.push.apply(p,n[v].nodes);for(var m,v=0;m=n.nodes[v];v++)null!=m.parentNode&&p.indexOf(m)<0&&M([m],[n[v]]);t.length<n.length&&(n.length=t.length),n.nodes=p}return n}function B(n,r,o,i,s,a,l,u){for(var c,h,f=[],d=[];n.view;){var p=n.view,v=n.view.$original||p,g=r.views?r.views.indexOf(v):-1,m=g>-1?r.controllers[g]:new(n.controller||t),y=m.instance;"object"==typeof y&&(c=y.name,"object"==typeof y.cached&&(h=y.cached),y.viewFn=[p,m]);var w=n&&n.attrs&&n.attrs.key;if(n=n.view(m),"retain"===n.subtree)return h?h:r;null!=w&&(n.attrs||(n.attrs={}),n.attrs.key=w),m.onunload&&jt.unloaders.set(m,m.onunload),f.push(v),d.push(m)}if(!n.tag&&d.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");if(n.attrs||(n.attrs={}),null!=h&&(r=h),r.attrs||(r.attrs={}),(n.tag!=r.tag||!K(n.attrs,r.attrs)||n.attrs.id!=r.attrs.id||n.attrs.key!=r.attrs.key||"string"===e(c)&&r.componentName!=c)&&r.nodes.length&&M(r.nodes,r),"string"!==e(n.tag))return r;var b,E,k=0===r.nodes.length,_=Object.keys(n.attrs),j=_.length>("key"in n.attrs?1:0);if(n.attrs.xmlns?l=n.attrs.xmlns:"svg"===n.tag?l="http://www.w3.org/2000/svg":"math"===n.tag&&(l="http://www.w3.org/1998/Math/MathML"),k){var O=W(o,l,n,i);b=O[0],E=O[1],r={tag:n.tag,attrs:j?L(b,n.tag,n.attrs,{},l):n.attrs,children:null!=n.children&&n.children.length>0?H(b,n.tag,void 0,void 0,n.children,r.children,!0,0,n.attrs.contenteditable?b:a,l,u):n.children,nodes:[b]},d.length&&(r.views=f,r.controllers=d),r.children&&!r.children.nodes&&(r.children.nodes=[]),"select"===n.tag&&"value"in n.attrs&&L(b,n.tag,{value:n.attrs.value},{},l),null!=E&&o.insertBefore(b,o.childNodes[E]||null)}else b=r.nodes[0],j&&L(b,n.tag,n.attrs,r.attrs,l),r.children=H(b,n.tag,void 0,void 0,n.children,r.children,!1,0,n.attrs.contenteditable?b:a,l,u),r.nodes.intact=!0,d.length&&(r.views=f,r.controllers=d),s===!0&&null!=b&&o.insertBefore(b,o.childNodes[i]||null);if("string"===e(c)&&(r.componentName=c),"function"===e(n.attrs.config)){var x=r.configContext=r.configContext||{},N=function(t){return function(){return n.attrs.config.apply(n,t)}};u.push(N([b,!k,x,r,[o,i,a,l]]))}return r}function W(t,e,n,r){var o,i=r;if(t&&t.childNodes.length){var s=U(t,r);if(o=s[0],i=s[1],o){if(o.tagName.toLowerCase()==n.tag.toLowerCase()&&o.id==n.attrs.id)return[o,null];M([o])}}return o=n.attrs.is?void 0===e?kt.createElement(n.tag,n.attrs.is):kt.createElementNS(e,n.tag,n.attrs.is):void 0===e?kt.createElement(n.tag):kt.createElementNS(e,n.tag),o.setAttribute("data-mref",r),[o,i]}function U(t,e){for(var n,r=0,o=t.childNodes.length;o>r;r++)if(n=t.childNodes[r],n.getAttribute&&n.getAttribute("data-mref")==e)return[n,r];return[]}function V(t,e,n,r,o,i,s){var a;if(0===e.nodes.length){if(""==t)return e;M([n.childNodes[o]]),t.$trusted?a=Y(n,o,t):(a=[kt.createTextNode(t)],n.nodeName.match(St)||n.insertBefore(a[0],n.childNodes[o]||null)),e="string number boolean".indexOf(typeof t)>-1?new t.constructor(t):t,e.nodes=a}else e.valueOf()!==t.valueOf()||i===!0?(a=e.nodes,s&&s===kt.activeElement||(t.$trusted?(M(a,e),a=Y(n,o,t)):"textarea"===r?n.value=t:s?s.innerHTML=t:((1===a[0].nodeType||a.length>1)&&(M(e.nodes,e),a=[kt.createTextNode(t)]),n.insertBefore(a[0],n.childNodes[o]||null),a[0].nodeValue=t)),e=new t.constructor(t),e.nodes=a):e.nodes.intact=!0;return e}function $(t){for(var n=0;n<t.length;n++)"array"===e(t[n])&&(t=t.concat.apply([],t),n--);return t}function K(t,e){var n=Object.keys(t).sort().join(),r=Object.keys(e).sort().join();return n===r}function Y(t,e,n){var r=t.childNodes[e];if(r){var o=1!==r.nodeType,i=kt.createElement("span");o?(t.insertBefore(i,r||null),i.insertAdjacentHTML("beforebegin",n),t.removeChild(i)):r.insertAdjacentHTML("beforebegin",n)}else t.insertAdjacentHTML("beforeend",n);for(var s,a=[];(s=t.childNodes[e++])!==r;)a.push(s);return a}function Q(t,e,n,r){var o={root:t,vNode:e,forceRecreation:n};return r===!0?X(o):void jt.renderQueue.addTarget({mergeType:1,root:t,processor:X,params:[o]})}function X(t){var e=t.root,n=t.vNode,r=t.forceRecreation;if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var o,i=[],s=e===kt||e===kt.documentElement,a=s?Bt:e;s&&"html"!==n.tag&&(n={tag:"html",attrs:{},children:n}),r&&G(a),o=H(a,null,void 0,void 0,n,Wt.get(a),!1,0,null,void 0,i),i.forEach(function(t){t()}),Wt.set(a,o)}function G(t){M(t.childNodes,Wt.get(t)),Wt.remove(t)}function Z(t){Vt!==!0&&(Vt=!0,t===!0&&(jt.forcing=!0),z(t),Vt=!1)}function z(t){var n,r,o,i;(0===Ut.length()||t===!0)&&"function"===e(jt.computePreRedrawHook)&&(jt.computePreRedrawHook(),jt.computePreRedrawHook=null),Ut.length()>0&&Ut.stop();for(var s=0,a=jt.roots.length;a>s;s++)n=jt.roots[s],r=jt.components[s],o=jt.controllers[s],i=jt.recreations[s],o&&("object"==typeof o.instance&&(o.instance.viewFn=[r.view,o]),Q(n,r.view?r.view(o):"",i,t)),jt.recreations[s]=void 0;t===!0&&(J(),jt.forcing=!1)}function J(){"function"===e(jt.computePostRedrawHook)&&(jt.computePostRedrawHook(),jt.computePostRedrawHook=null)}function tt(t){var e=t.processor,n=t.params;"function"==typeof e&&e.apply(null,n)}function et(t,e){var n,r,o,i;for(n=0,r=t.length;r>n;n++)if(i=nt(t[n],e)){o=n;break}return o>-1?(t.splice(o,1),t.push(i)):t.push(e),t}function nt(t,e){var n=t.root,r=e.root;if(t.mergeType&e.mergeType)return n===r?e:null;var o=h(n,r);return o?o===n?t:e:null}function rt(n,r,o){if(!n)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var i=jt.roots.indexOf(n);0>i&&(i=jt.roots.length);var s=!1,a={preventDefault:function(){s=!0,jt.computePreRedrawHook=jt.computePostRedrawHook=null}};if(jt.unloaders.each(function(t,e){t.call(e,a),e.onunload=null}),s?jt.unloaders.each(function(t,e){e.onunload=t}):jt.unloaders.clear(),jt.controllers[i]&&"function"===e(jt.controllers[i].onunload)&&jt.controllers[i].onunload(a),!s){jt.roots[i]=n;var l=$t=r=r||{controller:t},u=r.controller||t,c=new u;return l===$t&&(jt.controllers[i]=c,jt.components[i]=r,jt.recreations[i]=o),Z(),jt.controllers[i]}}function ot(t){var e=t.viewFn,n=e[0](e[1]),r=t.props.key,o=t.redrawData,i=o[0],s=o[1],a=o[2],l=o[3],u=[];null!=r&&(n.attrs=n.attrs||{},n.attrs.key=r),t.cached=H(i,null,void 0,void 0,n,t.cached,!1,s,a,l,u);for(var c=0,h=u.length;h>c;c++)u[c]()}function it(t,e){var n=i(e);return Object(t)!==t?n:(Object.keys(n).forEach(function(e){var o=n[e];void 0===o&&r(t,e)&&(n[e]=t[e])}),n)}function st(t,e){if(Object(e)!==e)return t;var n=i(t);return Object.keys(e).forEach(function(t){var r=e[t];void 0!==r&&(n[t]=r)}),n}function at(t,n){if("object"!==e(t))throw new TypeError("[createComponent]param should be a object! given: "+t);n&&(t.mixins=[].concat(n,t.mixins).filter(Boolean));var r={},o=ut(t);return r.controller=function(t,n){var r=new o(t,n),i={instance:r,_cachedValue:{}};return i.onunload=r.onunload.bind(r,r.componentWillUnmount),"string"===e(r.name)&&(i.name=r.name),i},r.view=ct(),r}function lt(t,r){var o;for("array"!==e(r)&&(r=n(arguments,1)),r=r.filter(function(t){return"object"===e(t)});r.length>0;)o=r.shift(),Object.keys(o).forEach(function(n){if("mixins"===n)return void(r=dt([].concat(o[n]),r));if(-1===Qt.indexOf(n))return-1!==Kt.indexOf(n)?void("array"===e(t[n])?t[n].push(o[n]):t[n]="function"===e(t[n])?[t[n],o[n]]:[o[n]]):void(t[n]=o[n])});Kt.forEach(function(n){if("array"===e(t[n])){var r=t[n].filter(function(t){return"function"===e(t)});t[n]=pt(-1!==Yt.indexOf(n),r)}})}function ut(t){var e,n=function(){Xt.apply(this,arguments),ht(n.prototype,this)};return n.prototype=Object.create(Xt.prototype),e=t.mixins||[],delete t.mixins,e=[].concat(e,t),lt(n.prototype,e),n}function ct(){return function(t,n,r){var o=t.instance,i=t._cachedValue.props,s=t._cachedValue.state,a=function(t,n,r,a,l){ft(o,"setInternalProps",t,a,l),n?ft(o,"componentDidUpdate",t,i,s):(ft(o,"componentDidMount",t),"function"===e(o.componentWillDetached)&&(r.onunload=o.componentWillDetached.bind(o,t)))};if(o.setProps(n,r),t._cachedValue.props=o.props,t._cachedValue.state=o.state,null!=o.root){if(ft(o,"shouldComponentUpdate",i,s)===!1)return{subtree:"retain"};ft(o,"componentWillUpdate",o.root,i,s)}else ft(o,"componentWillMount",i,s);var l=ft(o,"render",o.props,o.state);return l.attrs=l.attrs||{},l.attrs.config=a,l}}function ht(t,n){Object.keys(t).forEach(function(r){var o=t[r];("function"===e(o)||/^on[A-Z]\w*/.test(r))&&(n[r]=o.bind(n))})}function ft(t,r){var o=n(arguments,2);return"function"===e(t[r])?t[r].apply(t,o):void 0}function dt(t,n){var r,o,i=t.length;for(r=0;i>r;r++)o=t[r],"object"===e(o)&&-1===n.indexOf(o)&&n.unshift(o);return n}function pt(t,e){return function(){for(var r,o=n(arguments,0),i=this,s=0,a=e.length,l=o;a>s;s++)r=e[s],l=r.apply(i,o),o=t?l:o;return l}}var vt={};vt.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};var gt=/^\[object (\w+)\]$/,mt=Array.prototype.slice,yt=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,wt=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/;v.trust=function(t){return t=new String(t),t.$trusted=!0,t},g.prototype.addTarget=function(t){var n=this._queue.length;return"function"===e(this.options.onAddTarget)?this._queue=this.options.onAddTarget.call(this,this._queue,t):this._queue.push(t),0===n&&1===this._queue.length&&this.scheduleFlush(),this},g.prototype.removeTarget=function(t){var e=this._queue.indexOf(t);return-1!==e&&this._queue.splice(e,1),this},g.prototype.flush=function(){var t,n,r,o,i,s=new Date,a=this._cb,l=this._startPos;for(i=this._queue,r=l,o=i.length;o>r;r++){n=i[r];try{a.call(null,n)}catch(u){console[console.error?"error":"log"](u),console.log(u.stack)}if(t=new Date-s,t>xt){r++;break}}this._queue.splice(0,r),this._startPos=0,this._queue.length?this.scheduleFlush():"function"===e(this.options.onFinish)&&this.options.onFinish.call(null)},g.prototype.scheduleFlush=function(){return this._tick&&Dt(this._tick),this._tick=Tt(this.flush),this._tick},g.prototype.onFlush=function(t){if("function"!==e(t))throw new TypeError("[Batch.prototype.onFlush]need a Function here, but given "+t);return this._cb=t,this},g.prototype.length=function(){return this._queue.length},g.prototype.stop=function(){return Dt(this._tick),this._queue.length=0,this},["onAddTarget","onFinish"].forEach(function(t){g.prototype[t]=function(n){if("function"!==e(n))throw new TypeError("[Batch.prototype."+t+"]need a Function here, but given "+n);return this.options[t]=n,this}}),m.prototype={has:function(t){w(t);var e,n=this._keys;if(t!=t||0===t)for(e=n.length;e--&&!y(n[e],t););else e=n.indexOf(t);return this._index=e,e>-1},clear:function(){this._keys.length=0,this._values.length=0,this._index=-1},set:function(t,e){return this.has(t)?this._values[this._index]=e:this._values[this._keys.push(t)-1]=e,this},get:function(t,e){return this.has(t)?this._values[this._index]:(arguments.length>1&&this.set(t,e),e)},remove:function(t){var e=this._index;return this.has(t)&&(this._keys.splice(e,1),this._values.splice(e,1)),e>-1},each:function(t){if("function"==typeof t)for(var e=0,n=this._keys.length;n>e;e++)t(this._values[e],this._keys[e])}};var bt=b.prototype;bt.on=function(t,e,n){var r=O(this.domEvHandlerMap,t,u());return x(r,e,this,n),this},bt.off=function(t,e,n){var r=O(this.domEvHandlerMap,t);return r?(arguments.length>=3?N(r,e,this,n):2===arguments.length?N(r,e,this):T(r,this),0===Object.keys(r).length&&this.domEvHandlerMap.remove(t),this):this},bt.addGlobalEventListener=function(t,e){return x(this.globalListeners,t,this,e),this},bt.removeGlobalEventListener=function(t,e){return arguments.length>=2?N(this.globalListeners,t,this,e):1===arguments.length?N(this.globalListeners,t,this):T(this.globalListeners,this),this},bt.destroy=function(){this.unlistenTo(),this.listenedEvents=null,this.eventDispatchers=null,this.globalListeners=null,this.domEvHandlerMap.clear()},bt.listenTo=function(t){if(t in this.listenedEvents||(this.listenedEvents[t]=0),this.listenedEvents[t]++,1!==this.listenedEvents[t])return this;var e=this.eventDispatchers[t];return e||(e=this.eventDispatchers[t]=E(t,this)),D(this.root,t,e),this},bt.unlistenTo=function(t){var e=this.eventDispatchers,n=this;if(0===arguments.length)return Object.keys(e).filter(function(t){var n=!!e[t];return n&&(e[t]=1),n}).forEach(function(t){n.unlistenTo(t)}),this;if(!(t in this.listenedEvents)||0===this.listenedEvents[t])return console.log('[DOMDelegator unlistenTo]event "'+t+'" is already unlistened!'),this;if(this.listenedEvents[t]--,this.listenedEvents[t]>0)return this;var r=this.eventDispatchers[t];if(!r)throw new Error("[DOMDelegator unlistenTo]: cannot unlisten to "+t);return C(this.root,t,r),this};for(var Et="undefined"!=typeof window?window:{},kt=Et.document,_t="undefined"==typeof process||process.browser?"undefined"!=typeof window?"browser":"unknown":"nodejs",jt={forcing:!1,unloaders:new m,computePreRedrawHook:null,computePostRedrawHook:null,roots:[],recreations:[],components:[],controllers:[],domCacheMap:new m,domDelegator:new b,renderQueue:new g},Ot=0,xt=16,Nt=["webkit","moz","ms","o"],Tt=Et.requestAnimationFrame,Dt=Et.cancelAnimationFrame||Et.cancelRequestAnimationFrame,Ct=0,Pt=Nt.length;Pt>Ct&&!Tt;++Ct)Tt=Et[Nt[Ct]+"RequestAnimationFrame"],Dt=Et[Nt[Ct]+"CancelAnimationFrame"]||Et[Nt[Ct]+"CancelRequestAnimationFrame"];Tt||(Tt=function(t){var e=Date.now?Date.now():(new Date).getTime(),n=Math.max(0,xt-(e-Ot)),r=setTimeout(function(){t(e+n)},n);return Ot=e+n,r}),Dt||(Dt=function(t){return clearTimeout(t)});var At={all:["altKey","bubbles","cancelable","ctrlKey","eventPhase","metaKey","relatedTarget","shiftKey","target","timeStamp","type","view","which"],mouse:["button","buttons","clientX","clientY","layerX","layerY","offsetX","offsetY","pageX","pageY","screenX","screenY","toElement"],key:["char","charCode","key","keyCode"]},Mt=/^key|input/,Rt=/^(?:mouse|pointer|contextmenu)|click/;P.prototype=i(P.prototype,{init:function(t){A(this,t,"all"),this.originalEvent=t,this._bubbles=!1},preventDefault:function(){return this.originalEvent.preventDefault()},startPropagation:function(){this._bubbles=!0}});var Lt,Ft=jt.domCacheMap,Ht=jt.domDelegator,qt=jt.domDelegator,It=/^ev([A-Z]\w*)/,St=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/,Bt={appendChild:function(t){void 0===Lt&&(Lt=kt.createElement("html")),kt.documentElement&&kt.documentElement!==t?kt.replaceChild(t,kt.documentElement):kt.appendChild(t),this.childNodes=kt.childNodes},insertBefore:function(t){this.appendChild(t)},childNodes:[]},Wt=jt.domCacheMap,Ut=jt.renderQueue.onFinish(J),Vt=!1;jt.renderQueue.onFlush(tt).onAddTarget(et);var $t,Kt=["componentWillMount","componentDidMount","componentWillUpdate","componentDidUpdate","componentWillUnmount","componentWillDetached","componentWillReceiveProps","getInitialProps","getInitialState"],Yt=["getInitialProps","getInitialState","componentWillReceiveProps"],Qt=["setState","mixins","onunload","setInternalProps","redraw","setProps"],Xt=function(){function t(n,r){if(vt.classCallCheck(this,t),"object"!==e(n)&&null!=n)throw new TypeError("[Component]param for constructor should a object or null or undefined! given: "+n);this.props=i(this.defaultProps,it(this.defaultProps,n)),this.props.children=l(r),this.root=null,this.getInitialProps&&(this.props=this.getInitialProps(this.props)),this.getInitialState&&(this.state=this.getInitialState(this.props))}return t.prototype.setProps=function(t,n){"object"!==e(t)&&(t={}),this.componentWillReceiveProps&&(t=this.componentWillReceiveProps(t)),this.props=s(st(this.props,t)),this.props.children=l(n)},t.prototype.onunload=function(t){"function"===e(t)&&t.call(this),this.root=null,this.cached=null,this.redrawData=null},t.prototype.setInternalProps=function(t,e,n){this.root=t,this.cached=e,this.redrawData=n},t.prototype.redraw=function(){if(null!=this.redrawData){var t=this;jt.renderQueue.addTarget({mergeType:0,processor:ot,root:t.root,params:[t]})}},t.prototype.setState=function(t,e){null==this.state&&(this.state={}),this.state=i(this.state,t),e||"browser"!==_t||this.redraw()},t}(),Gt=v;return Gt.render=Q,Gt.redraw=Z,Gt.mount=rt,Gt.component=d,Gt.createComponent=at,Gt.domDelegator=jt.domDelegator,"undefined"==typeof Object.assign&&(Object.assign=o),Gt});